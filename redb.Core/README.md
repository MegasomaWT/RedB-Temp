# REDB - –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

**REDB** (Relational Entity Database) - —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ **EAV (Entity-Attribute-Value)** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–∏–±–∫–∏—Ö, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–∞–Ω–Ω—ã—Ö.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞—Ç—Ç–µ—Ä–Ω: Enhanced EAV (Entity-Attribute-Value)

**EAV** - —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –≤–∏–¥–µ —Å—É—â–Ω–æ—Å—Ç–µ–π (Entity), –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (Attribute) –∏ –∑–Ω–∞—á–µ–Ω–∏–π (Value). REDB —Ä–∞—Å—à–∏—Ä—è–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π EAV —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

- **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã** - —Å–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å—Ö–µ–º  
- **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏–π
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

#### 1. –°–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```sql
_types        -- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö (String, Long, DateTime, Boolean, etc.)
_schemes      -- –°—Ö–µ–º—ã –æ–±—ä–µ–∫—Ç–æ–≤ (—Ç–∏–ø—ã —Å—É—â–Ω–æ—Å—Ç–µ–π)
_structures   -- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–ª–µ–π (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤)
```

#### 2. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö  
```sql
_objects      -- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Entity)
_values       -- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π (Value)
_links        -- –°–≤—è–∑–∏ –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏
```

#### 3. –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```sql
_users        -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
_roles        -- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
_users_roles  -- –°–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π
_permissions  -- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç–∞–º
```

#### 4. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
```sql
_lists           -- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
_list_items      -- –≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
_dependencies    -- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å—Ö–µ–º–∞–º–∏
_functions       -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
_deleted_objects -- –ê—Ä—Ö–∏–≤ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü

### _objects - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π
```sql
_id              -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
_id_parent       -- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å (self-reference)
_id_scheme       -- –¢–∏–ø –æ–±—ä–µ–∫—Ç–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ _schemes)
_id_owner        -- –í–ª–∞–¥–µ–ª–µ—Ü –æ–±—ä–µ–∫—Ç–∞
_id_who_change   -- –ö—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∏–∑–º–µ–Ω—è–ª
_date_create     -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
_date_modify     -- –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
_date_begin      -- –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è
_date_complete   -- –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
_key             -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–ª—é—á
_code_int        -- –ß–∏—Å–ª–æ–≤–æ–π –∫–æ–¥
_code_string     -- –°—Ç—Ä–æ–∫–æ–≤—ã–π –∫–æ–¥
_code_guid       -- GUID –∫–æ–¥
_name            -- –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
_note            -- –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
_bool            -- –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –ø–æ–ª–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
_hash            -- GUID —Ö–µ—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —á–µ—Ä–µ–∑ `_id_parent`
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
- –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫—Ç–æ, –∫–æ–≥–¥–∞)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞

### _values - –¢–∞–±–ª–∏—Ü–∞ –∑–Ω–∞—á–µ–Ω–∏–π (EAV Core)
```sql
_id              -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
_id_structure    -- –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª—è
_id_object       -- –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä–µ–∫—Ç
_String          -- –°—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–¥–æ 850 —Å–∏–º–≤–æ–ª–æ–≤)
_Long            -- –ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
_Guid            -- GUID –∑–Ω–∞—á–µ–Ω–∏–µ
_Double          -- –ß–∏—Å–ª–æ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
_DateTime        -- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
_Boolean         -- –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
_ByteArray       -- –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
_Text            -- –î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
_Array           -- JSON –º–∞—Å—Å–∏–≤ (–µ—Å–ª–∏ _is_array = true –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ä—É (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ–±—ä–µ–∫—Ç)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤** - –µ—Å–ª–∏ –≤ `_structures._is_array = true`, –∑–Ω–∞—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–æ–ª–µ `_Array` –∫–∞–∫ JSON
  - **–ü—Ä–∏–º–∏—Ç–∏–≤—ã**: `["str1", "str2"]`, `[1, 2, 3]`, `[true, false]`
  - **–û–±—ä–µ–∫—Ç—ã**: `[101, 102, 103]` (—Ç–æ–ª—å–∫–æ ID, –ø–æ–ª–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)

### _structures - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ–ª–µ–π
```sql
_id              -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
_id_parent       -- –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö)
_id_scheme       -- –°—Ö–µ–º–∞, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è
_id_override     -- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
_id_type         -- –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö
_id_list         -- –°–≤—è–∑–∞–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
_name            -- –ò–º—è –ø–æ–ª—è
_alias           -- –ü—Å–µ–≤–¥–æ–Ω–∏–º
_order           -- –ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
_readonly        -- –¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
_allow_not_null  -- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—è
_is_array        -- –ú–∞—Å—Å–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–π
_is_compress     -- –°–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö
_store_null      -- –°–æ—Ö—Ä–∞–Ω—è—Ç—å NULL
_default_value   -- –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
_default_editor  -- –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ö–µ–º—ã
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–æ–≤** - –Ω–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –ë–î
- **–ì–∏–±–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ò–Ω–¥–µ–∫—Å—ã –ø–æ —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º
- **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—Ö–µ–º–∞–º** - –≤–æ–∑–º–æ–∂–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 3. –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–¢—Ä–∏–≥–≥–µ—Ä—ã –∞—É–¥–∏—Ç–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- **–ö–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω –ø–æ–ª–µ–π –∏ —Å—Ö–µ–º** - —Ç—Ä–∏–≥–≥–µ—Ä—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º C#

### 4. –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **JSON –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤** - `get_object_json()` —Å —Ä–µ–∫—É—Ä—Å–∏–µ–π –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- **–§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫** - `get_facets()` –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- **–ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π** - `search_objects_with_facets()` —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL FTS
- **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ EAV –≤–∫–ª—é—á–∞—è Object –∏ ListItem

## –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤

```sql
-- 1. –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É
INSERT INTO _schemes (_id, _name, _alias) 
VALUES (nextval('global_identity'), 'Employee', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫');

-- 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª–µ–π
INSERT INTO _structures (_id, _id_scheme, _id_type, _name, _alias, _order) 
VALUES 
  (nextval('global_identity'), [scheme_id], [string_type_id], 'first_name', '–ò–º—è', 1),
  (nextval('global_identity'), [scheme_id], [string_type_id], 'last_name', '–§–∞–º–∏–ª–∏—è', 2),
  (nextval('global_identity'), [scheme_id], [datetime_type_id], 'birth_date', '–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è', 3);

-- 3. –°–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç
INSERT INTO _objects (_id, _id_scheme, _id_owner, _id_who_change, _name) 
VALUES (nextval('global_identity'), [scheme_id], [user_id], [user_id], '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω');

-- 4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
INSERT INTO _values (_id, _id_structure, _id_object, _String) 
VALUES 
  (nextval('global_identity'), [first_name_structure_id], [object_id], '–ò–≤–∞–Ω'),
  (nextval('global_identity'), [last_name_structure_id], [object_id], '–ò–≤–∞–Ω–æ–≤');
```

### 2. –ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
SELECT DISTINCT o._id, o._name 
FROM _objects o
JOIN _values v ON v._id_object = o._id
JOIN _structures s ON s._id = v._id_structure
WHERE s._name = 'first_name' AND v._String = '–ò–≤–∞–Ω';

-- –ü–æ–∏—Å–∫ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏
SELECT o._id, o._name
FROM _objects o
WHERE o._id IN (
    SELECT v1._id_object 
    FROM _values v1 
    JOIN _structures s1 ON s1._id = v1._id_structure
    WHERE s1._name = 'first_name' AND v1._String = '–ò–≤–∞–Ω'
    INTERSECT
    SELECT v2._id_object 
    FROM _values v2 
    JOIN _structures s2 ON s2._id = v2._id_structure
    WHERE s2._name = 'last_name' AND v2._String = '–ò–≤–∞–Ω–æ–≤'
);
```

### 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏:

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç (–±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è –≤ –∫–æ—Ä–Ω–µ + properties)
SELECT get_object_json(object_id);

-- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≥–ª—É–±–∏–Ω—É —Ä–µ–∫—É—Ä—Å–∏–∏ –¥–ª—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤  
SELECT get_object_json(object_id, max_depth := 3);
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```json
{
  "id": 1001,
  "name": "–ü–µ—Ç—Ä–æ–≤ –ò–≤–∞–Ω",
  "scheme_id": 100,
  "scheme_name": "Employee",
  "parent_id": null,
  "owner_id": 1,
  "who_change_id": 1,
  "date_create": "2024-01-15T10:30:00",
  "date_modify": "2024-01-20T14:25:00",
  "date_begin": null,
  "date_complete": null,
  "key": null,
  "code_int": null,
  "code_string": "EMP001",
  "code_guid": null,
  "note": "–í–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
  "bool": true,
  "hash": "550e8400-e29b-41d4-a716-446655440000",
  "properties": {
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ü–µ—Ç—Ä–æ–≤", 
    "department": "IT",
    "salary": 120000,
    "isActive": true,
    "manager": {
      "id": 1002,
      "name": "–°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞",
      "scheme_id": 100,
      "scheme_name": "Employee",
      "properties": {
        "firstName": "–ê–Ω–Ω–∞",
        "lastName": "–°–∏–¥–æ—Ä–æ–≤–∞",
        "department": "HR"
      }
    },
    "skills": [
      {"id": 1, "value": "C#"},
      {"id": 2, "value": "PostgreSQL"}
    ]
  }
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏:
- **–ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON** - –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è –æ–±—ä–µ–∫—Ç–∞ –≤ –∫–æ—Ä–Ω–µ, —Å–≤–æ–π—Å—Ç–≤–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ properties
- **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (—Ç–∏–ø Object) 
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—Å–∏–≤–æ–≤** - –µ—Å–ª–∏ `_is_array = true`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—è `_Array`
  - **–ú–∞—Å—Å–∏–≤—ã –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤** - `["–∑–Ω–∞—á–µ–Ω–∏–µ1", "–∑–Ω–∞—á–µ–Ω–∏–µ2"]`
  - **–ú–∞—Å—Å–∏–≤—ã –æ–±—ä–µ–∫—Ç–æ–≤** - `[1, 2, 3]` (–º–∞—Å—Å–∏–≤ ID) —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ `get_object_json()`
- **–£–º–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤** EAV (String, Long, DateTime, Boolean, etc.)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤** (ListItem) —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π
- **Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≥–ª—É–±–∏–Ω—ã
- **–ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –≤—Å–µ –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è + —Å—Ö–µ–º–∞ + —Å–≤–æ–π—Å—Ç–≤–∞ –≤ –æ–¥–Ω–æ–º JSON

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ–∏—Å–∫–∞

### 1. –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_values_string ON _values (_String) WHERE _String IS NOT NULL;
CREATE INDEX idx_values_long ON _values (_Long) WHERE _Long IS NOT NULL;
CREATE INDEX idx_values_datetime ON _values (_DateTime) WHERE _DateTime IS NOT NULL;

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_values_structure_string ON _values (_id_structure, _String);
CREATE INDEX idx_values_object_structure ON _values (_id_object, _id_structure);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_objects_parent ON _objects (_id_parent);
CREATE INDEX idx_objects_scheme ON _objects (_id_scheme);
```

### 2. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
CREATE INDEX idx_fulltext_search ON _values 
USING gin(to_tsvector('russian', coalesce(_String, '') || ' ' || coalesce(_Text, '')));

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE OR REPLACE FUNCTION search_objects(search_text text)
RETURNS TABLE(object_id bigint, relevance real) AS $$
BEGIN
    RETURN QUERY
    SELECT DISTINCT v._id_object, ts_rank(
        to_tsvector('russian', coalesce(v._String, '') || ' ' || coalesce(v._Text, '')),
        to_tsquery('russian', search_text)
    ) as relevance
    FROM _values v
    WHERE to_tsvector('russian', coalesce(v._String, '') || ' ' || coalesce(v._Text, ''))
          @@ to_tsquery('russian', search_text)
    ORDER BY relevance DESC;
END;
$$ LANGUAGE plpgsql;
```

### 3. –§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –º–æ—â–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∞—Å–µ—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö:

#### –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∞—Å–µ—Ç–æ–≤
```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–ª—è —Å—Ö–µ–º—ã
SELECT get_facets(scheme_id);
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```json
{
  "department": ["IT", "HR", "–§–∏–Ω–∞–Ω—Å—ã"],
  "city": ["–ú–æ—Å–∫–≤–∞", "–°–ü–±", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥"],
  "salary": [50000, 75000, 100000, 120000],
  "is_active": [true, false],
  "manager": [
    {"id": 123, "name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò."},
    {"id": 456, "name": "–ü–µ—Ç—Ä–æ–≤ –ü.–ü."}
  ]
}
```

#### –§—É–Ω–∫—Ü–∏—è —Ñ–∞—Å–µ—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
```sql
-- –ü–æ–∏—Å–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
SELECT search_objects_with_facets(
    scheme_id := 100,
    facet_filters := '{
        "department": ["IT", "HR"],
        "city": ["–ú–æ—Å–∫–≤–∞"],
        "salary": [100000, 120000]
    }'::jsonb,
    limit_count := 50,
    offset_count := 0
);
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```json
{
  "objects": [
    {
      "id": 1001,
      "name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
      "scheme_id": 100,
      "scheme_name": "Employee",
      "parent_id": null,
      "owner_id": 1,
      "who_change_id": 1,
      "date_create": "2024-01-15T10:30:00Z",
      "date_modify": "2024-01-20T14:20:00Z",
      "date_begin": null,
      "date_complete": null,
      "key": null,
      "code_int": 12345,
      "code_string": "EMP001",
      "code_guid": null,
      "note": "–í–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
      "bool": true,
      "hash": "550e8400-e29b-41d4-a716-446655440000",
      "properties": {
        "department": "IT",
        "city": "–ú–æ—Å–∫–≤–∞", 
        "salary": 120000,
        "is_active": true
      }
    }
  ],
  "total_count": 25,
  "limit": 50,
  "offset": 0,
  "facets": {
    "department": ["IT", "HR"],
    "city": ["–ú–æ—Å–∫–≤–∞", "–°–ü–±"],
    "salary": [100000, 120000]
  }
}
```

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞—Å–µ—Ç–∞—Ö:
- **String, Long, Double, Boolean, DateTime** - –ø—Ä–æ—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- **Object** - —Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã `{"id": 123, "name": "–ò–º—è –æ–±—ä–µ–∫—Ç–∞"}`
- **ListItem** - —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ `{"id": 456, "value": "–ó–Ω–∞—á–µ–Ω–∏–µ"}`
- **ByteArray** - –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Base64
- **Text** - –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ** —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏** (limit/offset)
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ –ª—é–±—ã–º –ø–æ–ª—è–º
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —Å JOIN –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏
- **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö EAV

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ –ë–î

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Traditional RDBMS | NoSQL Document | EAV (REDB) | Graph DB | Object DB |
|----------|------------------|----------------|-------------|-----------|-----------|
| **–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö** | –ñ–µ—Å—Ç–∫–∞—è, —Å—Ç–∞—Ç–∏—á–Ω–∞—è | –ì–∏–±–∫–∞—è, –¥–∏–Ω–∞–º–∏—á–Ω–∞—è | –ì–∏–±–∫–∞—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ | –ì–∏–±–∫–∞—è | –û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê |
| **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã** | ‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤—è–∑–µ–π** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ REDB EAV –ø–æ–¥—Ö–æ–¥–∞

**‚úÖ –ü–ª—é—Å—ã:**
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –ë—ã—Å—Ç—Ä–æ–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ì–∏–±–∫–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∏–µ—Ä–∞—Ä—Ö–∏–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö UI

**‚ùå –ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
- –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- **CMS –∏ –ø–æ—Ä—Ç–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **CRM —Å–∏—Å—Ç–µ–º—ã** - —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤** - —Å–ª–æ–∂–Ω—ã–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **–°–∏—Å—Ç–µ–º—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞** - —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **IoT –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ç–∏–ø—ã –¥–∞—Ç—á–∏–∫–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤

### –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è:
- **–í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ OLTP** - –º–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã** - —Ç—Ä–µ–±—É—é—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- **–°–∏—Å—Ç–µ–º—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏** - –∫—Ä–∏—Ç–∏—á–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–∫–ª–∏–∫–∞
- **–ü—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –∏–∑–±—ã—Ç–æ—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

## –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω –ø–æ–ª–µ–π –∏ —Å—Ö–µ–º

–í —Å–∏—Å—Ç–µ–º–µ REDB —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º C#:

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π (`_structures`)
–¢—Ä–∏–≥–≥–µ—Ä `validate_structure_name()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `_structures`.

### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

#### 1. –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–º–µ–Ω–∞
–ò–º–µ–Ω–∞ –ø–æ–ª–µ–π –Ω–µ –º–æ–≥—É—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ —Ç–∞–±–ª–∏—Ü—ã `_objects`:
```
_id, _id_parent, _id_scheme, _id_owner, _id_who_change,
_date_create, _date_modify, _date_begin, _date_complete,
_key, _code_int, _code_string, _code_guid, _name, _note, _bool, _hash
```

#### 2. –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è C#
- **–ù–∞—á–∞–ª–æ –∏–º–µ–Ω–∏**: —Ç–æ–ª—å–∫–æ –±—É–∫–≤–∞ (a-z, A-Z) –∏–ª–∏ —Å–∏–º–≤–æ–ª –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (_)
- **–°–∏–º–≤–æ–ª—ã**: —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª—ã –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã**: –ø—Ä–æ–±–µ–ª—ã, —Ç–æ—á–∫–∏, –¥–µ—Ñ–∏—Å—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (@, #, $, % –∏ —Ç.–¥.)
- **–î–ª–∏–Ω–∞**: –º–∞–∫—Å–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞

#### 3. –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ C#
–ò–º–µ–Ω–∞ –ø–æ–ª–µ–π –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ C#:
```
abstract, as, base, bool, break, byte, case, catch, char, checked,
class, const, continue, decimal, default, delegate, do, double, else,
enum, event, explicit, extern, false, finally, fixed, float, for,
foreach, goto, if, implicit, in, int, interface, internal, is, lock,
long, namespace, new, null, object, operator, out, override, params,
private, protected, public, readonly, ref, return, sbyte, sealed,
short, sizeof, stackalloc, static, string, struct, switch, this,
throw, true, try, typeof, uint, ulong, unchecked, unsafe, ushort,
using, virtual, void, volatile, while
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

**‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞:**
```sql
firstName, lastName, phoneNumber, _address, user_Age, Account123
```

**‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞:**
```sql
-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è
INSERT INTO _structures (..., _name, ...) VALUES (..., '_id', ...);  -- –û–®–ò–ë–ö–ê

-- –ò–º–µ–Ω–∞ —Å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
INSERT INTO _structures (..., _name, ...) VALUES (..., 'first.Name', ...);  -- –û–®–ò–ë–ö–ê
INSERT INTO _structures (..., _name, ...) VALUES (..., 'first-name', ...);  -- –û–®–ò–ë–ö–ê
INSERT INTO _structures (..., _name, ...) VALUES (..., 'first name', ...);  -- –û–®–ò–ë–ö–ê

-- –ò–º–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å —Ü–∏—Ñ—Ä—ã
INSERT INTO _structures (..., _name, ...) VALUES (..., '1stName', ...);  -- –û–®–ò–ë–ö–ê

-- –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
INSERT INTO _structures (..., _name, ...) VALUES (..., 'class', ...);  -- –û–®–ò–ë–ö–ê
INSERT INTO _structures (..., _name, ...) VALUES (..., 'public', ...);  -- –û–®–ò–ë–ö–ê
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –ø–æ–ª–µ–π:
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
\i redb.Core.Postgres/sql/test_structure_validation.sql
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º (`_schemes`)
–¢—Ä–∏–≥–≥–µ—Ä `validate_scheme_name()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ `_schemes`, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤ C#.

### –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ö–µ–º:

#### 1. –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ C#
- **–ù–∞—á–∞–ª–æ –∏–º–µ–Ω–∏**: —Ç–æ–ª—å–∫–æ –±—É–∫–≤–∞ (a-z, A-Z) –∏–ª–∏ —Å–∏–º–≤–æ–ª –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (_)
- **–°–∏–º–≤–æ–ª—ã**: –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, —Å–∏–º–≤–æ–ª—ã –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –∏ —Ç–æ—á–∫–∏ (–¥–ª—è namespace)
- **–ó–∞–ø—Ä–µ—â–µ–Ω—ã**: –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (@, #, $, % –∏ —Ç.–¥.)
- **–î–ª–∏–Ω–∞**: –º–∞–∫—Å–∏–º—É–º 128 —Å–∏–º–≤–æ–ª–æ–≤

#### 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Namespace
- **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å**: —Ç–æ—á–∫–∞ (.) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ namespace
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —á–∞—Å—Ç–µ–π**: –∫–∞–∂–¥–∞—è —á–∞—Å—Ç—å –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: 
  - –ù–µ–ª—å–∑—è –Ω–∞—á–∏–Ω–∞—Ç—å –∏–ª–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å —Ç–æ—á–∫–æ–π
  - –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–µ —Ç–æ—á–∫–∏ –ø–æ–¥—Ä—è–¥ (..)
  - –ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º

#### 3. –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ C#
–ò–º–µ–Ω–∞ —Å—Ö–µ–º (–≤–∫–ª—é—á–∞—è —á–∞—Å—Ç–∏ namespace) –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ C#:
```
abstract, as, base, bool, break, byte, case, catch, char, checked,
class, const, continue, decimal, default, delegate, do, double, else,
enum, event, explicit, extern, false, finally, fixed, float, for,
foreach, goto, if, implicit, in, int, interface, internal, is, lock,
long, namespace, new, null, object, operator, out, override, params,
private, protected, public, readonly, ref, return, sbyte, sealed,
short, sizeof, stackalloc, static, string, struct, switch, this,
throw, true, try, typeof, uint, ulong, unchecked, unsafe, ushort,
using, virtual, void, volatile, while
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º:

**‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Å—Ö–µ–º:**
```sql
-- –ü—Ä–æ—Å—Ç—ã–µ –∏–º–µ–Ω–∞ –∫–ª–∞—Å—Å–æ–≤
Employee, UserAccount, _BaseEntity, Product123, Order_Item

-- –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º namespace
MyCompany.Domain.User, System.Collections.Generic, _Internal._Hidden._Entity
```

**‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Å—Ö–µ–º:**
```sql
-- –ò–º–µ–Ω–∞ —Å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'User-Account', ...);  -- –û–®–ò–ë–ö–ê
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'User Account', ...);  -- –û–®–ò–ë–ö–ê

-- –ü—Ä–æ–±–ª–µ–º—ã —Å namespace
INSERT INTO _schemes (..., _name, ...) VALUES (..., '.User', ...);         -- –û–®–ò–ë–ö–ê (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Ç–æ—á–∫–∏)
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'User.', ...);         -- –û–®–ò–ë–ö–ê (–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ—á–∫–æ–π)
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'Domain..User', ...);  -- –û–®–ò–ë–ö–ê (–¥–≤–µ —Ç–æ—á–∫–∏)

-- –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'class', ...);         -- –û–®–ò–ë–ö–ê
INSERT INTO _schemes (..., _name, ...) VALUES (..., 'Domain.class.User', ...); -- –û–®–ò–ë–ö–ê
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Å—Ö–µ–º:
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
\i redb.Core.Postgres/sql/test_scheme_validation.sql
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è C# –∫–ª–∞—Å—Å–æ–≤ –∏–∑ —Å—Ö–µ–º:**
```sql
-- –°—Ö–µ–º–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ –∫–ª–∞—Å—Å Employee
INSERT INTO _schemes (_id, _name, _alias) VALUES (..., 'Employee', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫');

-- –°—Ö–µ–º–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ MyCompany.Domain.User
INSERT INTO _schemes (_id, _name, _alias) VALUES (..., 'MyCompany.Domain.User', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ C#:**
```csharp
// –ü—Ä–æ—Å—Ç–æ–π –∫–ª–∞—Å—Å
public class Employee { ... }

// –ö–ª–∞—Å—Å —Å namespace
namespace MyCompany.Domain 
{
    public class User { ... }
}
```

### –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã namespace —Å—Ö–µ–º

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ namespace —Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ü—Ä–∏–º–µ—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º —Å namespace

```sql
-- –°—Ö–µ–º—ã TrueSight.Models –≤ —Å–∏—Å—Ç–µ–º–µ
INSERT INTO _schemes (_id, _id_parent, _name, _alias, _name_space) VALUES 
(1001, NULL, 'TrueSight.Models.AnalyticsMetrics', '–ú–µ—Ç—Ä–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏', 'TrueSight.Models'),
(1002, NULL, 'TrueSight.Models.AnalyticsRecord', '–ó–∞–ø–∏—Å—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏', 'TrueSight.Models');
```

#### 2. –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è AnalyticsMetrics

```sql
-- –ü–æ–ª—è —Å—Ö–µ–º—ã 1001 (AnalyticsMetrics)
INSERT INTO _structures (_id, _id_scheme, _id_type, _name, _alias, _order, _allow_not_null) VALUES 
(1003, 1001, -9223372036854775704, 'AdvertId', 'ID —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏', 1, true),
(1004, 1001, -9223372036854775704, 'Baskets', '–ö–æ—Ä–∑–∏–Ω—ã', 2, NULL),
(1005, 1001, -9223372036854775704, 'Base', '–ë–∞–∑–∞', 3, NULL),
(1006, 1001, -9223372036854775704, 'Association', '–ê—Å—Å–æ—Ü.', 4, NULL),
(1007, 1001, -9223372036854775707, 'Costs', '–ó–∞—Ç—Ä–∞—Ç—ã', 5, NULL),
(1008, 1001, -9223372036854775704, 'Rate', '–°—Ç–∞–≤–∫–∞', 6, NULL),
(1009, 1001, -9223372036854775700, 'Note', '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ', 7, NULL);
```

#### 3. –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è AnalyticsRecord

```sql  
-- –ü–æ–ª—è —Å—Ö–µ–º—ã 1002 (AnalyticsRecord)
INSERT INTO _structures (_id, _id_scheme, _id_type, _name, _alias, _order, _allow_not_null) VALUES 
(1010, 1002, -9223372036854775708, 'Date', '–î–∞—Ç–∞', 1, true),
(1011, 1002, -9223372036854775700, 'Article', '–ê—Ä—Ç–∏–∫—É–ª', 2, true),
(1012, 1002, -9223372036854775704, 'Orders', '–ó–∞–∫–∞–∑—ã', 3, NULL),
(1013, 1002, -9223372036854775704, 'Stock', '–û—Å—Ç–∞—Ç–∫–∏', 4, NULL),
(1014, 1002, -9223372036854775704, 'TotalCart', '–û–±—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞', 5, NULL),
(1015, 1002, -9223372036854775704, 'Price', '–¶–µ–Ω–∞', 6, NULL),
(1016, 1002, -9223372036854775703, 'AutoMetrics', '–ú–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ', 7, true),    -- Object —Å—Å—ã–ª–∫–∞
(1017, 1002, -9223372036854775703, 'AuctionMetrics', '–ú–µ—Ç—Ä–∏–∫–∏ –∞—É–∫—Ü–∏–æ–Ω–∞', 8, true), -- Object —Å—Å—ã–ª–∫–∞  
(1018, 1002, -9223372036854775700, 'Tag', '–¢–µ–≥ (–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞)', 9, NULL);
```

#### 4. –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO _objects (_id, _id_scheme, _id_owner, _name) VALUES 
(1019, 1001, 0, 'AutoMetrics Example'),     -- AnalyticsMetrics –æ–±—ä–µ–∫—Ç
(1020, 1001, 0, 'AuctionMetrics Example'),  -- AnalyticsMetrics –æ–±—ä–µ–∫—Ç  
(1021, 1002, 0, 'AnalyticsRecord Example'); -- AnalyticsRecord –æ–±—ä–µ–∫—Ç

-- –ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è AnalyticsRecord (1021)
INSERT INTO _values (_id, _id_structure, _id_object, _String, _Long, _DateTime) VALUES 
(1034, 1010, 1021, NULL, NULL, '2025-07-15T00:00:00'::TIMESTAMP), -- Date
(1035, 1011, 1021, '–ø—Ç 5—Ö260', NULL, NULL),                       -- Article  
(1036, 1012, 1021, NULL, 0, NULL),                                -- Orders
(1037, 1013, 1021, NULL, 151, NULL),                              -- Stock
(1038, 1014, 1021, NULL, 2, NULL),                                -- TotalCart
(1039, 1016, 1021, NULL, 1019, NULL),                             -- AutoMetrics (Object ID)
(1040, 1017, 1021, NULL, 1020, NULL),                             -- AuctionMetrics (Object ID)
(1041, 1018, 1021, '–ø—Ç', NULL, NULL);                             -- Tag
```

#### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ JSON –æ–±—ä–µ–∫—Ç–∞ —Å namespace

```sql
-- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ AnalyticsRecord —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
SELECT get_object_json(1021, 3);
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç JSON:**
```json
{
  "id": 1021,
  "name": "AnalyticsRecord Example", 
  "scheme_id": 1002,
  "scheme_name": "TrueSight.Models.AnalyticsRecord",
  "namespace": "TrueSight.Models",
  "date_create": "2024-01-15T10:30:00Z",
  "properties": {
    "Date": "2025-07-15T00:00:00Z",
    "Article": "–ø—Ç 5—Ö260",
    "Orders": 0,
    "Stock": 151, 
    "TotalCart": 2,
    "AutoMetrics": {
      "id": 1019,
      "name": "AutoMetrics Example",
      "scheme_name": "TrueSight.Models.AnalyticsMetrics", 
      "properties": {
        "AdvertId": 0,
        "Baskets": 0,
        "Base": 0,
        "Association": 0,
        "Costs": 0.0,
        "Rate": 0
      }
    },
    "AuctionMetrics": {
      "id": 1020,
      "name": "AuctionMetrics Example",
      "scheme_name": "TrueSight.Models.AnalyticsMetrics",
      "properties": {
        "AdvertId": 0,
        "Baskets": 0,
        "Base": 0,
        "Association": 0,
        "Costs": 0.0,
        "Rate": 0
      }
    },
    "Tag": "–ø—Ç"
  }
}
```

#### 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è C# –∫–ª–∞—Å—Å–æ–≤ –∏–∑ namespace —Å—Ö–µ–º

```csharp
// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏–∑ —Å—Ö–µ–º TrueSight.Models
namespace TrueSight.Models
{
    public class AnalyticsMetrics
    {
        public long AdvertId { get; set; }        // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
        public long? Baskets { get; set; }
        public long? Base { get; set; }
        public long? Association { get; set; }
        public double? Costs { get; set; }
        public long? Rate { get; set; }
        public string Note { get; set; }          // –º–æ–∂–µ—Ç –±—ã—Ç—å null
    }

    public class AnalyticsRecord  
    {
        public DateTime Date { get; set; }        // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
        public string Article { get; set; }      // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
        public long? Orders { get; set; }
        public long? Stock { get; set; }
        public long? TotalCart { get; set; }
        public long? Price { get; set; }
        public AnalyticsMetrics AutoMetrics { get; set; }    // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
        public AnalyticsMetrics AuctionMetrics { get; set; } // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
        public string Tag { get; set; }
    }
}
```

#### 7. –§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ namespace —Å—Ö–µ–º–∞–º

```sql
-- –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞—Å–µ—Ç—ã –¥–ª—è AnalyticsRecord
SELECT get_facets(1002);

-- –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –ø–æ –¥–∞—Ç–µ –∏ –∞—Ä—Ç–∏–∫—É–ª—É  
SELECT search_objects_with_facets(
    1002,
    '{
        "Date": ["2025-07-15"],
        "Article": ["–ø—Ç 5—Ö260"],
        "Tag": ["–ø—Ç"]
    }'::jsonb
);
```

–¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ —Å —á–µ—Ç–∫–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π namespace –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö C# –∫–ª–∞—Å—Å–æ–≤.

## –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø–∞

–í REDB —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç–∞–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

```sql
_permissions    -- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ò–õ–ò —Ä–æ–ª—å)
_users         -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã  
_roles         -- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
_users_roles   -- –°–≤—è–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã

#### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ò–õ–ò —Ä–æ–ª—å)
_permissions(
    _id_user bigint NULL,      -- –ü—Ä—è–º–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    _id_role bigint NULL,      -- –†–æ–ª–µ–≤–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    _id_ref bigint NOT NULL,   -- –û–±—ä–µ–∫—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    _select boolean,           -- –ü—Ä–∞–≤–æ —á—Ç–µ–Ω–∏—è
    _insert boolean,           -- –ü—Ä–∞–≤–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö
    _update boolean,           -- –ü—Ä–∞–≤–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    _delete boolean            -- –ü—Ä–∞–≤–æ —É–¥–∞–ª–µ–Ω–∏—è
)
```

#### 2. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
- –ï—Å–ª–∏ —É –æ–±—ä–µ–∫—Ç–∞ –ù–ï–¢ –ø—Ä—è–º–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è ‚Üí –∏—â–µ–º —É —Ä–æ–¥–∏—Ç–µ–ª—è
- –ï—Å–ª–∏ —É —Ä–æ–¥–∏—Ç–µ–ª—è –ù–ï–¢ ‚Üí –∏–¥–µ–º –≤—ã—à–µ –ø–æ –¥–µ—Ä–µ–≤—É –¥–æ –∫–æ—Ä–Ω—è
- –ü–µ—Ä–≤–æ–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –ø–æ—Ç–æ–º–∫–∞–º

#### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) - `_id_user`
2. **–†–æ–ª–µ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è** (–æ–±—ã—á–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) - `_id_role`

### VIEW –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–π VIEW `v_user_permissions` –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏:

```sql
-- VIEW –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
-- 1. –ò—â–µ—Ç –±–ª–∏–∂–∞–π—à–µ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤–≤–µ—Ä—Ö –ø–æ –¥–µ—Ä–µ–≤—É
-- 2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å > —Ä–æ–ª—å)
-- 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç —Ä–æ–ª–µ–≤—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ users_roles
-- 4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã (–æ–±—ä–µ–∫—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

SELECT * FROM v_user_permissions;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- object_id | user_id | permission_type | can_select | can_insert | can_update | can_delete
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 1. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```sql
-- –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–ª—è —á—Ç–µ–Ω–∏—è
SELECT o.*
FROM _objects o
JOIN v_user_permissions vup ON vup.object_id = o._id
WHERE vup.user_id = 12345 
  AND vup.can_select = true;
```

#### 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ö–µ–º–µ —Å –ø—Ä–∞–≤–∞–º–∏

```sql
-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ö–µ–º—ã
SELECT 
    o._id,
    o._name,
    o._code_string,
    vup.permission_type,
    CASE 
        WHEN vup.can_update THEN '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'
        WHEN vup.can_select THEN '–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ'
        ELSE '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞'
    END as access_level
FROM _objects o
JOIN v_user_permissions vup ON vup.object_id = o._id
WHERE vup.user_id = 12345 
  AND vup.can_select = true
  AND o._id_scheme = 100
ORDER BY o._date_modify DESC;
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∞–≤

```sql
-- –û–±—ä–µ–∫—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
SELECT o._id, o._name
FROM _objects o
JOIN v_user_permissions vup ON vup.object_id = o._id
WHERE vup.user_id = 12345 
  AND vup.can_update = true
  AND o._id_scheme = 100;

-- –û–±—ä–µ–∫—Ç—ã —Å –ø—Ä–∞–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö
SELECT o._id, o._name
FROM _objects o
JOIN v_user_permissions vup ON vup.object_id = o._id
WHERE vup.user_id = 12345 
  AND vup.can_insert = true;
```

#### 4. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –ø—Ä–∞–≤–∞–º–∏

```sql
-- –î–µ—Ä–µ–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞
WITH RECURSIVE object_tree AS (
    -- –ö–æ—Ä–Ω–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
    SELECT 
        o._id,
        o._name,
        o._id_parent,
        vup.can_select,
        vup.can_update,
        vup.permission_type,
        0 as level
    FROM _objects o
    JOIN v_user_permissions vup ON vup.object_id = o._id
    WHERE o._id_parent IS NULL
      AND vup.user_id = 12345
      AND vup.can_select = true
      AND o._id_scheme = 100
    
    UNION ALL
    
    -- –î–æ—á–µ—Ä–Ω–∏–µ –æ–±—ä–µ–∫—Ç—ã
    SELECT 
        o._id,
        o._name,
        o._id_parent,
        vup.can_select,
        vup.can_update,
        vup.permission_type,
        ot.level + 1
    FROM _objects o
    JOIN object_tree ot ON o._id_parent = ot._id
    JOIN v_user_permissions vup ON vup.object_id = o._id
    WHERE vup.user_id = 12345
      AND vup.can_select = true
)
SELECT 
    LPAD('', level * 2, ' ') || _name as tree_name,
    CASE 
        WHEN can_update THEN '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ'
        ELSE 'üëÅÔ∏è –ß—Ç–µ–Ω–∏–µ' 
    END as access,
    permission_type
FROM object_tree 
ORDER BY level, _name;
```

#### 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

```sql
-- –°–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ —Å—Ö–µ–º–∞–º
SELECT 
    s._name as scheme_name,
    COUNT(*) as total_accessible,
    COUNT(*) FILTER (WHERE vup.can_select) as can_read,
    COUNT(*) FILTER (WHERE vup.can_insert) as can_create_children,
    COUNT(*) FILTER (WHERE vup.can_update) as can_edit,
    COUNT(*) FILTER (WHERE vup.can_delete) as can_delete,
    COUNT(*) FILTER (WHERE vup.permission_type = 'user') as personal_rights,
    COUNT(*) FILTER (WHERE vup.permission_type = 'role') as role_rights
FROM _objects o
JOIN v_user_permissions vup ON vup.object_id = o._id
JOIN _schemes s ON s._id = o._id_scheme
WHERE vup.user_id = 12345
  AND vup.can_select = true
GROUP BY s._id, s._name
ORDER BY total_accessible DESC;
```

#### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

–î–ª—è —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `get_user_permissions_for_object`:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –ø—Ä–∞–≤–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç
SELECT * FROM get_user_permissions_for_object(1001, 12345);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- object_id | user_id | permission_source_id | permission_type | can_select | can_insert | can_update | can_delete
-- 1001      | 12345   | 1000                | role           | true       | false      | true       | false

-- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞—Ç—å –æ–±—ä–µ–∫—Ç
SELECT EXISTS(
    SELECT 1 FROM get_user_permissions_for_object(1001, 12345) 
    WHERE can_select = true
) as can_read;

-- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç  
SELECT EXISTS(
    SELECT 1 FROM get_user_permissions_for_object(1001, 12345)
    WHERE can_update = true  
) as can_edit;

-- –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–æ—Ç–∫—É–¥–∞ –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è)
SELECT 
    CASE 
        WHEN permission_type = 'user' THEN '–õ–∏—á–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ'
        ELSE '–ß–µ—Ä–µ–∑ —Ä–æ–ª—å: ' || r._name
    END as permission_source,
    CASE 
        WHEN permission_source_id = object_id THEN '–ü—Ä—è–º–æ–µ'
        ELSE '–ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –æ–±—ä–µ–∫—Ç–∞ ' || permission_source_id
    END as inheritance_type
FROM get_user_permissions_for_object(1001, 12345) p
LEFT JOIN _roles r ON r._id = p._id_role;
```

#### 7. –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞ —Ä–∞–∑
WITH target_objects AS (
    SELECT unnest(ARRAY[1001, 1002, 1003, 1004]) as object_id
)
SELECT 
    to.object_id,
    o._name,
    COALESCE(p.can_select, false) as can_read,
    COALESCE(p.can_update, false) as can_edit,
    COALESCE(p.permission_type, 'no_access') as access_type
FROM target_objects to
JOIN _objects o ON o._id = to.object_id
LEFT JOIN get_user_permissions_for_object(to.object_id, 12345) p ON true
ORDER BY to.object_id;
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–µ–≤—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

```sql
-- –î–∞—Ç—å —Ä–æ–ª–∏ "Manager" –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
INSERT INTO _permissions (_id, _id_role, _id_ref, _select, _insert, _update, _delete)
VALUES (
    nextval('global_identity'),
    (SELECT _id FROM _roles WHERE _name = 'Manager'),
    1001,  -- ID –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
    true,  -- —á—Ç–µ–Ω–∏–µ
    true,  -- —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö
    false, -- —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    false  -- —É–¥–∞–ª–µ–Ω–∏–µ
);
```

#### 2. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

```sql
-- –î–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
INSERT INTO _permissions (_id, _id_user, _id_ref, _select, _insert, _update, _delete)
VALUES (
    nextval('global_identity'),
    12345,  -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è John
    2001,   -- ID —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞  
    true,   -- —á—Ç–µ–Ω–∏–µ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª–µ–≤–æ–π –∑–∞–ø—Ä–µ—Ç)
    false,  -- —Å–æ–∑–¥–∞–Ω–∏–µ
    true,   -- —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–æ)
    false   -- —É–¥–∞–ª–µ–Ω–∏–µ
);
```

#### 3. –ó–∞–ø—Ä–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ—Ç–∫–µ

```sql
-- –ó–∞–ø—Ä–µ—Ç–∏—Ç—å —Ä–æ–ª–∏ "Employee" –¥–æ—Å—Ç—É–ø –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
INSERT INTO _permissions (_id, _id_role, _id_ref, _select, _insert, _update, _delete)
VALUES (
    nextval('global_identity'),
    (SELECT _id FROM _roles WHERE _name = 'Employee'),
    3001,  -- ID –ø–∞–ø–∫–∏ "–§–∏–Ω–∞–Ω—Å—ã"
    false, -- –∑–∞–ø—Ä–µ—Ç —á—Ç–µ–Ω–∏—è (—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö –ø–æ—Ç–æ–º–∫–æ–≤)
    false,
    false,
    false
);
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EF Core

```csharp
// –ú–æ–¥–µ–ª—å –¥–ª—è VIEW
public class VUserPermission
{
    public long ObjectId { get; set; }
    public long UserId { get; set; }
    public long PermissionId { get; set; }
    public string PermissionType { get; set; }
    public long? IdRole { get; set; }
    public bool CanSelect { get; set; }
    public bool CanInsert { get; set; }
    public bool CanUpdate { get; set; }
    public bool CanDelete { get; set; }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–µ
public async Task<List<RObject>> GetAccessibleObjects(long userId, long schemeId)
{
    return await _context.Objects
        .Join(_context.VUserPermissions.Where(p => p.UserId == userId && p.CanSelect),
              o => o.Id,
              p => p.ObjectId,
              (o, p) => o)
        .Where(o => o.IdScheme == schemeId)
        .ToListAsync();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
public async Task<bool> CanUserEditObject(long userId, long objectId)
{
    return await _context.VUserPermissions
        .AnyAsync(p => p.UserId == userId && p.ObjectId == objectId && p.CanUpdate);
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–∞–≤–∞—Ö –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç
public async Task<UserPermissionDetail> GetUserPermissionDetails(long userId, long objectId)
{
    var result = await _context.Database.SqlQueryRaw<UserPermissionResult>(
        "SELECT * FROM get_user_permissions_for_object({0}, {1})", 
        objectId, userId
    ).FirstOrDefaultAsync();
    
    if (result == null)
        return new UserPermissionDetail { HasAccess = false };
        
    return new UserPermissionDetail
    {
        HasAccess = true,
        CanSelect = result.CanSelect,
        CanInsert = result.CanInsert, 
        CanUpdate = result.CanUpdate,
        CanDelete = result.CanDelete,
        PermissionType = result.PermissionType,
        PermissionSourceId = result.PermissionSourceId,
        IsInherited = result.PermissionSourceId != objectId
    };
}

// –ú–æ–¥–µ–ª–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏
public class UserPermissionResult
{
    public long ObjectId { get; set; }
    public long UserId { get; set; }
    public long PermissionSourceId { get; set; }
    public string PermissionType { get; set; }
    public long? IdRole { get; set; }
    public bool CanSelect { get; set; }
    public bool CanInsert { get; set; }
    public bool CanUpdate { get; set; }
    public bool CanDelete { get; set; }
}

public class UserPermissionDetail
{
    public bool HasAccess { get; set; }
    public bool CanSelect { get; set; }
    public bool CanInsert { get; set; }
    public bool CanUpdate { get; set; }
    public bool CanDelete { get; set; }
    public string PermissionType { get; set; }
    public long PermissionSourceId { get; set; }
    public bool IsInherited { get; set; }
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è performance permissions

–°–∏—Å—Ç–µ–º–∞ REDB –≤–∫–ª—é—á–∞–µ—Ç **—Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è permissions** –¥–ª—è —É–∑–ª–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø–æ–∏—Å–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ –≥–ª—É–±–æ–∫–∏—Ö –∏–µ—Ä–∞—Ä—Ö–∏—è—Ö.

#### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞ `auto_create_node_permissions()`

```sql
-- –¢—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ INSERT –≤ _objects
-- –ï—Å–ª–∏ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∏–º–µ–µ—Ç _id_parent, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
-- 1. –ï—Å—Ç—å –ª–∏ —É —Ä–æ–¥–∏—Ç–µ–ª—è permission? ‚Üí –ï—Å–ª–∏ –î–ê - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
-- 2. –ï—Å–ª–∏ –ù–ï–¢ - –∏—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π permission –≤–≤–µ—Ä—Ö –ø–æ –¥–µ—Ä–µ–≤—É
-- 3. –°–æ–∑–¥–∞–µ–º –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è –∫–æ–ø–∏—é –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ permission
```

#### üöÄ –†–∞–¥–∏–∫–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ë–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä–∞ | –° —Ç—Ä–∏–≥–≥–µ—Ä–æ–º | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|----------|--------------|-------------|-----------|
| –î–µ—Ä–µ–≤–æ 3 —É—Ä–æ–≤–Ω—è | 3 –∏—Ç–µ—Ä–∞—Ü–∏–∏ CTE | max 2 –∏—Ç–µ—Ä–∞—Ü–∏–∏ | **2x** |
| –î–µ—Ä–µ–≤–æ 10 —É—Ä–æ–≤–Ω–µ–π | 10 –∏—Ç–µ—Ä–∞—Ü–∏–π CTE | max 2 –∏—Ç–µ—Ä–∞—Ü–∏–∏ | **5x** |
| –î–µ—Ä–µ–≤–æ 50 —É—Ä–æ–≤–Ω–µ–π | 50 –∏—Ç–µ—Ä–∞—Ü–∏–π CTE | max 2 –∏—Ç–µ—Ä–∞—Ü–∏–∏ | **25x** |

```sql
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –í–°–ï–ì–î–ê –º–∞–∫—Å–∏–º—É–º 2 –∏—Ç–µ—Ä–∞—Ü–∏–∏
WITH RECURSIVE permission_search AS (
    -- –ò—Ç–µ—Ä–∞—Ü–∏—è 1: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–∞–º –æ–±—ä–µ–∫—Ç
    SELECT object_id, current_id, level=0
    
    UNION ALL
    
    -- –ò—Ç–µ—Ä–∞—Ü–∏—è 2: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è (—É –Ω–µ–≥–æ –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –µ—Å—Ç—å permission)
    SELECT object_id, parent_id, level=1
    -- –°–¢–û–ü! –î–∞–ª—å—à–µ –Ω–µ –∏–¥–µ–º - permission –Ω–∞–π–¥–µ–Ω
)
```

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ permissions

```sql
-- –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Ç—Ä–∏–≥–≥–µ—Ä–∞:
-- 1. –°–æ–∑–¥–∞–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É —Å permission
INSERT INTO _permissions (_id, _id_role, _id_ref, _select, _insert, _update, _delete)
VALUES (1, (SELECT _id FROM _roles WHERE _name = 'Manager'), 1000, true, true, false, false);

-- 2. –°–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–∏–π –æ–±—ä–µ–∫—Ç
INSERT INTO _objects (_id, _id_parent, _id_scheme, _name)
VALUES (1001, 1000, 100, '–ü–æ–¥–ø–∞–ø–∫–∞');

-- 3. –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ 1000 permission (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ –±—ã–ª–æ)
-- 4. –¢–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ permission –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ—Ç–æ–º–∫–∞ = –º–∞–∫—Å–∏–º—É–º 2 –∏—Ç–µ—Ä–∞—Ü–∏–∏!
```

#### VIEW –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–° —Ç—Ä–∏–≥–≥–µ—Ä–æ–º VIEW `v_user_permissions` —Ä–∞–±–æ—Ç–∞–µ—Ç **–≤ —Ä–∞–∑—ã –±—ã—Å—Ç—Ä–µ–µ**:

```sql
-- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ permissions –¥–ª—è –ª—é–±–æ–π –≥–ª—É–±–∏–Ω—ã –¥–µ—Ä–µ–≤–∞
SELECT * FROM v_user_permissions 
WHERE user_id = 12345 AND object_id IN (–æ—á–µ–Ω—å_–≥–ª—É–±–æ–∫–∏–µ_–æ–±—ä–µ–∫—Ç—ã);

-- –†–µ–∑—É–ª—å—Ç–∞—Ç: O(1-2) –≤–º–µ—Å—Ç–æ O(–≥–ª—É–±–∏–Ω–∞_–¥–µ—Ä–µ–≤–∞)
```

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç–∞
```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤:
-- 1. –í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –æ–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
INSERT INTO _permissions VALUES (role:'Employee', object:1000, select:true, insert:false, update:false, delete:false);

-- 2. –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ —Å–≤–æ–∏—Ö –æ—Ç–¥–µ–ª–∞—Ö  
INSERT INTO _permissions VALUES (role:'Manager', object:2000, select:true, insert:true, update:true, delete:false);

-- 3. –î–∏—Ä–µ–∫—Ç–æ—Ä –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞
INSERT INTO _permissions VALUES (user:director_id, object:1, select:true, insert:true, update:true, delete:true);

-- 4. –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞
INSERT INTO _permissions VALUES (role:'TopManager', object:9000, select:true, insert:true, update:true, delete:false);
INSERT INTO _permissions VALUES (role:'Employee', object:9000, select:false, insert:false, update:false, delete:false);
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å–∏—Å—Ç–µ–º—ã

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - VIEW –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö JOIN'–æ–≤  
‚úÖ **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤ –∫ –ø–æ—Ç–æ–º–∫–∞–º  
‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –≤–∞–∂–Ω–µ–µ —Ä–æ–ª–µ–≤—ã—Ö  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —è–≤–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º  
‚úÖ **EF Core —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ LINQ –∑–∞–ø—Ä–æ—Å—ã  

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ—â–Ω—ã–π –∏ –≥–∏–±–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ª—é–±—ã—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π! üîê

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
```sql
-- –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
CREATE MATERIALIZED VIEW mv_employee_summary AS
SELECT 
    o._id,
    o._name,
    MAX(CASE WHEN s._name = 'first_name' THEN v._String END) as first_name,
    MAX(CASE WHEN s._name = 'last_name' THEN v._String END) as last_name,
    MAX(CASE WHEN s._name = 'birth_date' THEN v._DateTime END) as birth_date
FROM _objects o
JOIN _values v ON v._id_object = o._id
JOIN _structures s ON s._id = v._id_structure
JOIN _schemes sc ON sc._id = o._id_scheme
WHERE sc._name = 'Employee'
GROUP BY o._id, o._name;
```

### 2. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
```sql
-- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ _values –ø–æ —Å—Ö–µ–º–∞–º
CREATE TABLE _values_partition_scheme_1 
PARTITION OF _values 
FOR VALUES IN (SELECT _id FROM _schemes WHERE _name = 'Employee');
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä —Å—Ö–µ–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

REDB –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é EAV –ø–∞—Ç—Ç–µ—Ä–Ω–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â—É—é –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –≥–∏–±–∫–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é. –°–∏—Å—Ç–µ–º–∞ –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, —Ç—Ä–µ–±—É—é—â–∏—Ö —á–∞—Å—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. **–¢—â–∞—Ç–µ–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º** - –ø—Ä–æ–¥—É–º—ã–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞—Ä–∞–Ω–µ–µ
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π  
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–æ–ª—å–∑—ã –∏–∑ –≥–∏–±–∫–æ—Å—Ç–∏
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
5. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º** - –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ, –≥–∏–±–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∑–∞—Ç—Ä–∞—Ç–∞–º–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è REDB

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –ø–µ—Ä–µ–¥–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

#### üöÄ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è performance**
- **–¢—Ä–∏–≥–≥–µ—Ä `auto_create_node_permissions()`** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–¥–æ 25x –¥–ª—è –≥–ª—É–±–æ–∫–∏—Ö –∏–µ—Ä–∞—Ä—Ö–∏–π)
- **VIEW `v_user_permissions`** —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é O(1-2) –≤–º–µ—Å—Ç–æ O(–≥–ª—É–±–∏–Ω–∞)
- **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ** permissions —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å > —Ä–æ–ª—å

#### üèóÔ∏è **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ namespace —Å—Ö–µ–º—ã**
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ C# namespace** –≤ –∏–º–µ–Ω–∞—Ö —Å—Ö–µ–º (`TrueSight.Models.AnalyticsRecord`)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö C# –∫–ª–∞—Å—Å–æ–≤ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω** –ø–æ–ª–µ–π –∏ —Å—Ö–µ–º —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º C#
- **–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ** —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ JSON

#### üìä **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ EAV**
- **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã** –≤ –ø–æ–ª–µ `_Array` (–ø—Ä–∏–º–∏—Ç–∏–≤—ã –∏ –æ–±—ä–µ–∫—Ç—ã)
- **–§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö  
- **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π** —Å VIEW –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö JOIN'–æ–≤ –≤ EF Core
- **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å Entity Framework Core

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ REDB –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ PostgreSQL:

### üîç –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- `get_facets(scheme_id)` - –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ñ–∞—Å–µ—Ç–æ–≤ –¥–ª—è UI —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `search_objects_with_facets(scheme_id, filters, limit, offset)` - —Ñ–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —á–µ—Ä–µ–∑ get_object_json
- `search_objects(search_text)` - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ README)
- `get_user_permissions_for_object(object_id, user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

### ÔøΩÔøΩ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `get_object_json(object_id, max_depth)` - –æ–±—ä–µ–∫—Ç –≤ JSON —Å –±–∞–∑–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ –≤ –∫–æ—Ä–Ω–µ
- `validate_structure_name()` - —Ç—Ä–∏–≥–≥–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–º–µ–Ω –ø–æ–ª–µ–π
- `validate_scheme_name()` - —Ç—Ä–∏–≥–≥–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–º–µ–Ω —Å—Ö–µ–º

### üóÇÔ∏è –°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞
- `ftr__objects__deleted_objects()` - —Ç—Ä–∏–≥–≥–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
- `auto_create_node_permissions()` - —Ç—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è permissions –¥–ª—è —É–∑–ª–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (—Ä–∞–¥–∏–∫–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)

### üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

```sql
-- –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞—Å–µ—Ç—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
SELECT get_facets(100);

-- –ù–∞–π—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ IT –æ—Ç–¥–µ–ª–∞ –≤ –ú–æ—Å–∫–≤–µ
SELECT search_objects_with_facets(
    100, 
    '{"department": ["IT"], "city": ["–ú–æ—Å–∫–≤–∞"]}'::jsonb
);

-- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—ä–µ–∫—Ç–µ —Å –º–∞—Å—Å–∏–≤–∞–º–∏
SELECT get_object_json(1001, 3);

-- –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ —Å –º–∞—Å—Å–∏–≤–æ–º –Ω–∞–≤—ã–∫–æ–≤ (Object[] = –º–∞—Å—Å–∏–≤ ID)
INSERT INTO _values (_id, _id_structure, _id_object, _Array) 
VALUES (
    nextval('global_identity'), 
    [id_—Å—Ç—Ä—É–∫—Ç—É—Ä—ã_skills], 
    1001, 
    '[101, 102, 103]'::text  -- ID –æ–±—ä–µ–∫—Ç–æ–≤-–Ω–∞–≤—ã–∫–æ–≤
);

-- –ü—Ä–∏–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ (—Ç–µ–≥–∏)
INSERT INTO _values (_id, _id_structure, _id_object, _Array) 
VALUES (
    nextval('global_identity'), 
    [id_—Å—Ç—Ä—É–∫—Ç—É—Ä—ã_tags], 
    1001, 
    '["backend", "database", "api"]'::text
);

-- üîç **–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä: TrueSight.Models Analytics**

-- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç AnalyticsRecord —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
SELECT get_object_json(1021, 3);
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ–±—ä–µ–∫—Ç —Å Date="2025-07-15", Article="–ø—Ç 5—Ö260", Stock=151
-- + –≤–ª–æ–∂–µ–Ω–Ω—ã–µ AutoMetrics –∏ AuctionMetrics –æ–±—ä–µ–∫—Ç—ã

-- –ü–æ–∏—Å–∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É –∏ –¥–∞—Ç–µ
SELECT search_objects_with_facets(
    1002,  -- —Å—Ö–µ–º–∞ TrueSight.Models.AnalyticsRecord
    '{
        "Article": ["–ø—Ç 5—Ö260"],
        "Date": ["2025-07-15T00:00:00"],
        "Tag": ["–ø—Ç"]
    }'::jsonb,
    10, 0
);

-- –ü–æ–ª—É—á–∏—Ç—å —Ñ–∞—Å–µ—Ç—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è UI —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
SELECT get_facets(1002);
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è Article, Stock, Tag + —Å—Å—ã–ª–∫–∏ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º
SELECT * FROM get_user_permissions_for_object(1021, 12345);

-- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
SELECT 
    CASE 
        WHEN EXISTS(SELECT 1 FROM get_user_permissions_for_object(2001, 12345) WHERE can_update = true)
        THEN '–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'
        ELSE '–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ'
    END as edit_access;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
SELECT 
    object_id,
    permission_source_id,
    CASE 
        WHEN object_id = permission_source_id THEN '–ü—Ä—è–º–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ'
        ELSE '–ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç –æ–±—ä–µ–∫—Ç–∞ ' || permission_source_id
    END as inheritance_info,
    permission_type
FROM get_user_permissions_for_object(3001, 12345);

-- üìä **–ê–Ω–∞–ª–∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:**

-- –ù–∞–π—Ç–∏ –≤—Å–µ AnalyticsRecord —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ AutoMetrics
WITH auto_metrics_filter AS (
    SELECT _id_object 
    FROM _values v
    JOIN _structures s ON s._id = v._id_structure
    WHERE s._name = 'AutoMetrics' 
      AND v._Long = 1019  -- ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ AutoMetrics –æ–±—ä–µ–∫—Ç–∞
)
SELECT o.*, get_object_json(o._id, 2) as full_data
FROM _objects o
JOIN auto_metrics_filter amf ON amf._id_object = o._id
WHERE o._id_scheme = 1002;

-- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º (Stock)
SELECT 
    COUNT(*) as total_records,
    AVG(v._Long) as avg_stock,
    MIN(v._Long) as min_stock,
    MAX(v._Long) as max_stock
FROM _values v
JOIN _structures s ON s._id = v._id_structure  
JOIN _objects o ON o._id = v._id_object
WHERE s._name = 'Stock' 
  AND o._id_scheme = 1002
  AND v._Long IS NOT NULL;
```

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤—Å–µ —Ç–∏–ø—ã EAV —Å–∏—Å—Ç–µ–º—ã. 