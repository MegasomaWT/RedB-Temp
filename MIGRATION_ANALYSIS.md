# üîÑ –ê–ù–ê–õ–ò–ó –ú–ò–ì–†–ê–¶–ò–ô –î–õ–Ø REDB EAV –ê–†–•–ò–¢–ï–ö–¢–£–†–´

## üìã **–°–û–î–ï–†–ñ–ê–ù–ò–ï**
1. [–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ](#—Ç–µ–∫—É—â–µ–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ)
2. [–¢–∏–ø—ã –º–∏–≥—Ä–∞—Ü–∏–π](#—Ç–∏–ø—ã-–º–∏–≥—Ä–∞—Ü–∏–π)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ-—Ä–µ—à–µ–Ω–∏—è)
4. [–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏](#–ª—É—á—à–∏–µ-–ø—Ä–∞–∫—Ç–∏–∫–∏)
5. [–†–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

---

## üîç **–¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï**

### ‚úÖ **–ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:**
- **Code-First —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - `SyncSchemeAsync<TProps>()`
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä** - —Ä–µ—Ñ–ª–µ–∫—Å–∏—è C# —Ç–∏–ø–æ–≤
- **–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** - —Ç–∞–±–ª–∏—Ü–∞ `_deleted_objects`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π** - `IValidationProvider`
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ breaking changes** - –∞–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤

### ‚ùå **–ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º** - –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
- **–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π** - —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è —É–¥–∞–ª—è—é—Ç—Å—è
- **–°–ª–∏—è–Ω–∏–µ/—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π** - –Ω–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞
- **–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π** - –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥
- **–ü–æ—à–∞–≥–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ä–∞–∑—É

---

## üéØ **–¢–ò–ü–´ –ú–ò–ì–†–ê–¶–ò–ô**

### 1. **–°–ú–ï–ù–ê –¢–ò–ü–ê –î–ê–ù–ù–´–•**
```csharp
// –ë—ã–ª–æ
public class Product { public string Price { get; set; } }

// –°—Ç–∞–ª–æ  
public class Product { public decimal Price { get; set; } }
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î–∞–Ω–Ω—ã–µ –≤ `_values._String` –Ω—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `_values._Double`
- –í–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ ("abc" ‚Üí decimal)
- –ù—É–∂–Ω—ã –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã –Ω–∞ C#

### 2. **–ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–ï –ü–û–õ–ï–ô**
```csharp
// –ë—ã–ª–æ
public class Product { public string Name { get; set; } }

// –°—Ç–∞–ª–æ
public class Product { public string Title { get; set; } }
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–µ–π—á–∞—Å: `Name` —É–¥–∞–ª—è–µ—Ç—Å—è, `Title` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ
- –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
- –ù—É–∂–Ω–æ: –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 3. **–°–õ–ò–Ø–ù–ò–ï –ü–û–õ–ï–ô (N ‚Üí 1)**
```csharp
// –ë—ã–ª–æ
public class Person { 
    public string FirstName { get; set; }
    public string LastName { get; set; }
}

// –°—Ç–∞–ª–æ
public class Person { 
    public string FullName { get; set; }
}
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å `FirstName + " " + LastName ‚Üí FullName`
- –õ–æ–≥–∏–∫–∞ —Å–ª–∏—è–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω–æ–π
- –ù—É–∂–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã

### 4. **–†–ê–ó–î–ï–õ–ï–ù–ò–ï –ü–û–õ–ï–ô (1 ‚Üí N)**
```csharp
// –ë—ã–ª–æ
public class Person { 
    public string FullName { get; set; }
}

// –°—Ç–∞–ª–æ
public class Person { 
    public string FirstName { get; set; }
    public string LastName { get; set; }
}
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å `"John Doe" ‚Üí FirstName="John", LastName="Doe"`
- –ü–∞—Ä—Å–∏–Ω–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–º
- –ù—É–∂–Ω—ã —É–º–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞–∑–±–æ—Ä–∞

### 5. **–í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ò –ú–ï–¢–ö–ò**
```csharp
[Migration("v1.2.0")]
public class ProductV2 { 
    public decimal Price { get; set; }  // –±—ã–ª–æ string
    public string Title { get; set; }   // –±—ã–ª–æ Name
}
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ö–∞–∫ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã?
- –ö–∞–∫ –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ?
- –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π?

### 6. **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–ò–ü–´ –ú–ò–ì–†–ê–¶–ò–ô**

#### **6.1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```csharp
// –ë—ã–ª–æ: optional
public string? Email { get; set; }

// –°—Ç–∞–ª–æ: required  
public string Email { get; set; } = "";
```

#### **6.2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–Ω–æ—Å—Ç–∏**
```csharp
// –ë—ã–ª–æ: –æ–¥–∏–Ω–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
public string Tag { get; set; }

// –°—Ç–∞–ª–æ: –º–∞—Å—Å–∏–≤
public string[] Tags { get; set; }
```

#### **6.3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π**
```csharp
public class Order {
    public decimal Price { get; set; }
    public int Quantity { get; set; }
    
    // –ù–æ–≤–æ–µ –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ
    public decimal Total => Price * Quantity;
}
```

#### **6.4. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–≤—è–∑–µ–π**
```csharp
// –ë—ã–ª–æ: –ø—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞
public long CategoryId { get; set; }

// –°—Ç–∞–ª–æ: –æ–±—ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞
public Category Category { get; set; }
```

---

## üèóÔ∏è **–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø**

### 1. **–°–ò–°–¢–ï–ú–ê –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–Ø –°–•–ï–ú**

```sql
-- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º
CREATE TABLE _scheme_versions (
    _id bigint PRIMARY KEY,
    _id_scheme bigint NOT NULL,
    _version varchar(50) NOT NULL,
    _migration_script text NULL,
    _date_applied timestamp DEFAULT now(),
    _applied_by bigint NOT NULL,
    _rollback_script text NULL,
    _is_breaking boolean DEFAULT false,
    CONSTRAINT FK_scheme_versions_schemes FOREIGN KEY (_id_scheme) REFERENCES _schemes (_id)
);

-- –¢–∞–±–ª–∏—Ü–∞ –º–∏–≥—Ä–∞—Ü–∏–π
CREATE TABLE _migrations (
    _id bigint PRIMARY KEY,
    _name varchar(250) NOT NULL,
    _version varchar(50) NOT NULL,
    _date_applied timestamp DEFAULT now(),
    _applied_by bigint NOT NULL,
    _success boolean DEFAULT true,
    _error_message text NULL,
    _execution_time_ms bigint NULL
);
```

### 2. **–ö–û–ù–í–ï–†–¢–û–†–´ –î–ê–ù–ù–´–•**

```csharp
public interface IDataConverter
{
    bool CanConvert(Type fromType, Type toType);
    Task<object?> ConvertAsync(object? value, Type fromType, Type toType);
    Task<List<ConversionError>> ValidateAsync(IEnumerable<object?> values, Type fromType, Type toType);
}

// –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã
public class StringToDecimalConverter : IDataConverter
{
    public bool CanConvert(Type fromType, Type toType) 
        => fromType == typeof(string) && toType == typeof(decimal);
    
    public async Task<object?> ConvertAsync(object? value, Type fromType, Type toType)
    {
        if (value == null) return null;
        if (decimal.TryParse(value.ToString(), out var result))
            return result;
        throw new ConversionException($"Cannot convert '{value}' to decimal");
    }
}
```

### 3. **–ú–ò–ì–†–ê–¶–ò–û–ù–ù–´–ï –°–ö–†–ò–ü–¢–´**

```csharp
[Migration("1.0.0", "1.1.0")]
public class ProductPriceMigration : IMigration
{
    public string Description => "Convert Price from string to decimal";
    
    public async Task UpAsync(IMigrationContext context)
    {
        // 1. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        await context.AddStructureAsync("Price", typeof(decimal));
        
        // 2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        await context.ConvertDataAsync("Price", typeof(string), typeof(decimal), 
            new StringToDecimalConverter());
        
        // 3. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        await context.RemoveStructureAsync("Price", typeof(string));
    }
    
    public async Task DownAsync(IMigrationContext context)
    {
        // –û—Ç–∫–∞—Ç: decimal ‚Üí string
        await context.ConvertDataAsync("Price", typeof(decimal), typeof(string),
            new DecimalToStringConverter());
    }
}
```

### 4. **–ü–ï–†–ï–ò–ú–ï–ù–û–í–ê–ù–ò–ï –ü–û–õ–ï–ô**

```csharp
[Migration("1.1.0", "1.2.0")]
public class ProductNameToTitleMigration : IMigration
{
    public async Task UpAsync(IMigrationContext context)
    {
        // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
        await context.RenameStructureAsync("Name", "Title");
    }
    
    public async Task DownAsync(IMigrationContext context)
    {
        await context.RenameStructureAsync("Title", "Name");
    }
}
```

### 5. **–°–õ–ò–Ø–ù–ò–ï –ò –†–ê–ó–î–ï–õ–ï–ù–ò–ï –ü–û–õ–ï–ô**

```csharp
[Migration("1.2.0", "1.3.0")]
public class PersonNameMigration : IMigration
{
    public async Task UpAsync(IMigrationContext context)
    {
        // –°–ª–∏—è–Ω–∏–µ: FirstName + LastName ‚Üí FullName
        await context.MergeFieldsAsync(
            sourceFields: new[] { "FirstName", "LastName" },
            targetField: "FullName",
            merger: (values) => $"{values[0]} {values[1]}".Trim()
        );
    }
    
    public async Task DownAsync(IMigrationContext context)
    {
        // –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ: FullName ‚Üí FirstName + LastName
        await context.SplitFieldAsync(
            sourceField: "FullName",
            targetFields: new[] { "FirstName", "LastName" },
            splitter: (fullName) => {
                var parts = fullName?.Split(' ', 2) ?? new string[0];
                return new[] { 
                    parts.Length > 0 ? parts[0] : "",
                    parts.Length > 1 ? parts[1] : ""
                };
            }
        );
    }
}
```

---

## üéØ **–õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò**

### 1. **–ü–†–ò–ù–¶–ò–ü–´ –ú–ò–ì–†–ê–¶–ò–ô**

#### **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **–í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±—ç–∫–∞–ø** –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** - –≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –ø–µ—Ä–µ–¥ –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π
- ‚úÖ **–û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

#### **üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- ‚úÖ **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –Ω–µ –ø–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
- ‚úÖ **–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞

#### **üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –≤–µ—Ä—Å–∏–π
- ‚úÖ **Graceful degradation** - —Ä–∞–±–æ—Ç–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª–µ–π

### 2. **–°–¢–†–ê–¢–ï–ì–ò–ò –ú–ò–ì–†–ê–¶–ò–ô**

#### **üéØ Blue-Green Deployment**
```csharp
// –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä—è–¥–æ–º —Å–æ —Å—Ç–∞—Ä—ã–º–∏
await context.AddStructureAsync("Title", typeof(string)); // –Ω–æ–≤–æ–µ –ø–æ–ª–µ
// –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ "Name" –ø–æ–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

// –≠—Ç–∞–ø 2: –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã–º–∏
await context.CopyDataAsync("Name", "Title");

// –≠—Ç–∞–ø 3: –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–æ–¥ –Ω–∞ –Ω–æ–≤—ã–µ –ø–æ–ª—è
// [–î–µ–ø–ª–æ–π –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞]

// –≠—Ç–∞–ø 4: –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è (—á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π)
await context.RemoveStructureAsync("Name", typeof(string));
```

#### **üîÑ Rolling Updates**
```csharp
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º –æ–±–∞ –ø–æ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
public class Product {
    [Obsolete("Use Title instead")]
    public string Name { get; set; }
    
    public string Title { get; set; }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
public string Name {
    get => Title;
    set => Title = value;
}
```

### 3. **–û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö**

```csharp
public class MigrationResult
{
    public bool Success { get; set; }
    public List<ConversionError> Errors { get; set; } = new();
    public int ProcessedRecords { get; set; }
    public int FailedRecords { get; set; }
    public TimeSpan ExecutionTime { get; set; }
}

public class ConversionError
{
    public long ObjectId { get; set; }
    public string FieldName { get; set; }
    public object? OriginalValue { get; set; }
    public string ErrorMessage { get; set; }
    public ConversionErrorType Type { get; set; }
}

public enum ConversionErrorType
{
    InvalidFormat,      // "abc" ‚Üí decimal
    ValueTooLarge,      // 999999999999999 ‚Üí int
    RequiredFieldNull,  // null ‚Üí required field
    CustomValidation    // –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
}
```

---

## üõ†Ô∏è **–†–ï–ê–õ–ò–ó–ê–¶–ò–Ø**

### 1. **–ò–ù–¢–ï–†–§–ï–ô–°–´ –ú–ò–ì–†–ê–¶–ò–ô**

```csharp
public interface IMigrationProvider
{
    Task<List<PendingMigration>> GetPendingMigrationsAsync<TProps>(string? schemeName = null);
    Task<MigrationResult> ApplyMigrationAsync(IMigration migration);
    Task<MigrationResult> RollbackMigrationAsync(string migrationName);
    Task<List<AppliedMigration>> GetAppliedMigrationsAsync();
}

public interface IMigrationContext
{
    // –°—Ç—Ä—É–∫—Ç—É—Ä—ã
    Task AddStructureAsync(string name, Type type, bool isRequired = false, bool isArray = false);
    Task RemoveStructureAsync(string name, Type type);
    Task RenameStructureAsync(string oldName, string newName);
    Task ChangeStructureTypeAsync(string name, Type oldType, Type newType, IDataConverter converter);
    
    // –î–∞–Ω–Ω—ã–µ
    Task<int> ConvertDataAsync(string fieldName, Type fromType, Type toType, IDataConverter converter);
    Task<int> CopyDataAsync(string sourceField, string targetField);
    Task<int> MergeFieldsAsync(string[] sourceFields, string targetField, Func<object?[], object?> merger);
    Task<int> SplitFieldAsync(string sourceField, string[] targetFields, Func<object?, object?[]> splitter);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    Task<List<ConversionError>> ValidateConversionAsync(string fieldName, Type fromType, Type toType, IDataConverter converter);
    Task<long> CountRecordsAsync(long schemeId);
    
    // –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    Task BeginTransactionAsync();
    Task CommitTransactionAsync();
    Task RollbackTransactionAsync();
}
```

### 2. **–ê–¢–†–ò–ë–£–¢–´ –ò –ú–ï–¢–ê–î–ê–ù–ù–´–ï**

```csharp
[AttributeUsage(AttributeTargets.Class)]
public class MigrationAttribute : Attribute
{
    public string FromVersion { get; }
    public string ToVersion { get; }
    public bool IsBreaking { get; set; }
    public string Description { get; set; } = "";
    
    public MigrationAttribute(string fromVersion, string toVersion)
    {
        FromVersion = fromVersion;
        ToVersion = toVersion;
    }
}

[AttributeUsage(AttributeTargets.Property)]
public class MigratedFromAttribute : Attribute
{
    public string OldName { get; }
    public Type? OldType { get; set; }
    public string? ConverterType { get; set; }
    
    public MigratedFromAttribute(string oldName)
    {
        OldName = oldName;
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
public class Product
{
    [MigratedFrom("Name")]
    public string Title { get; set; } = "";
    
    [MigratedFrom("Price", OldType = typeof(string), ConverterType = nameof(StringToDecimalConverter))]
    public decimal Price { get; set; }
}
```

### 3. **–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï –ú–ò–ì–†–ê–¶–ò–ô**

```csharp
public class AutoMigrationDetector
{
    public List<RequiredMigration> DetectMigrations<TProps>(long schemeId)
    {
        var migrations = new List<RequiredMigration>();
        var properties = typeof(TProps).GetProperties();
        
        foreach (var prop in properties)
        {
            var migratedFrom = prop.GetCustomAttribute<MigratedFromAttribute>();
            if (migratedFrom != null)
            {
                migrations.Add(new RequiredMigration
                {
                    Type = MigrationType.Rename,
                    OldName = migratedFrom.OldName,
                    NewName = prop.Name,
                    OldType = migratedFrom.OldType ?? prop.PropertyType,
                    NewType = prop.PropertyType,
                    ConverterType = migratedFrom.ConverterType
                });
            }
        }
        
        return migrations;
    }
}
```

### 4. **–ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø**

```csharp
// 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
[Migration("1.0.0", "1.1.0", Description = "Improve product model")]
public class ProductMigrationV1_1 : IMigration
{
    public async Task UpAsync(IMigrationContext context)
    {
        // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
        await context.RenameStructureAsync("Name", "Title");
        
        // –°–º–µ–Ω–∞ —Ç–∏–ø–∞
        await context.ChangeStructureTypeAsync("Price", typeof(string), typeof(decimal), 
            new StringToDecimalConverter());
        
        // –°–ª–∏—è–Ω–∏–µ –ø–æ–ª–µ–π
        await context.MergeFieldsAsync(
            new[] { "FirstName", "LastName" }, 
            "FullName",
            values => $"{values[0]} {values[1]}".Trim()
        );
    }
}

// 2. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏
var migrationProvider = serviceProvider.GetService<IMigrationProvider>();
var pendingMigrations = await migrationProvider.GetPendingMigrationsAsync<Product>();

foreach (var migration in pendingMigrations)
{
    Console.WriteLine($"Applying migration: {migration.Name}");
    var result = await migrationProvider.ApplyMigrationAsync(migration);
    
    if (!result.Success)
    {
        Console.WriteLine($"Migration failed: {result.Errors.Count} errors");
        foreach (var error in result.Errors.Take(10))
        {
            Console.WriteLine($"  Object {error.ObjectId}: {error.ErrorMessage}");
        }
        break;
    }
}
```

---

## üéØ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

1. **üî• –ö—Ä–∏—Ç–∏—á–Ω–æ:**
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º
   - –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã (string ‚Üî number ‚Üî date)
   - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
   - –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞—Ç–æ–≤

2. **üìà –í–∞–∂–Ω–æ:**
   - –°–ª–∏—è–Ω–∏–µ/—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –ü—Ä–æ–≥—Ä–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–π
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. **‚ú® –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
   - Blue-Green deployment
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –æ–±–µ—Å–ø–µ—á–∏—Ç —ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Ä–∏—Å–∫–∞–º–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
